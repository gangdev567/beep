<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Insert title here</title>
  <link rel="stylesheet" href="/css/sidebar.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  <link rel="canonical" href="https://getbootstrap.kr/docs/5.3/examples/footers/">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.15.0/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/sidebar.css" >
  <link rel="stylesheet" href="/css/nav.css" >
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script src="https://kit.fontawesome.com/1306328925.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="/css/nav.css" >
  <link rel="stylesheet" href="/css/switch.css">
  <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
  <style>
 /* ì±„íŒ… í™˜ì˜ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ë§ */
.msgArea div {
  margin-bottom: 5px;
  padding: 8px;
}



.msgArea div span {
  font-weight: bold;
}


 /* ì „ì²´ ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
section.home {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-top: 40px; /* Navigation barì˜ ë†’ì´ë§Œí¼ ì—¬ë°± ì¶”ê°€ */
}

/* ë¹„ë””ì˜¤ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ */
.video-container {
  width: 70%; /* ë¹„ë””ì˜¤ ì»¨í…Œì´ë„ˆì˜ ë„ˆë¹„ ì¡°ì ˆ ê°€ëŠ¥ */
  position: relative;
  margin-right: 20px; /* ë¹„ë””ì˜¤ì™€ ì±„íŒ… ì‚¬ì´ ê°„ê²© ì¡°ì ˆ ê°€ëŠ¥ */
}

.video-container video {
  width: 1320px;
  height: auto;
  margin-left: 10px;
  display: block;
  border-radius: 8px;
}

/* ì±„íŒ… ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ */
.cnter-item:last-child {
  width: 30%; /* ì±„íŒ… ì»¨í…Œì´ë„ˆì˜ ë„ˆë¹„ ì¡°ì ˆ ê°€ëŠ¥ */
  display: flex;
  flex-direction: column;
  height: 100%;
}

.chat-container {
  flex: 1;
  display: flex;
  flex-direction: column;
}

/* ì±„íŒ… ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ ì¶”ê°€ ë° ìˆ˜ì • */
.cnter-item:last-child {
  position: fixed; /* í™”ë©´ ìƒë‹¨ì— ê³ ì • */
  top: 60px; /* í™”ë©´ ìƒë‹¨ì— ê³ ì •ì‹œí‚¤ê¸° ìœ„í•œ ê°’ */
  right: 0; /* í™”ë©´ ìš°ì¸¡ì— ê³ ì •ì‹œí‚¤ê¸° ìœ„í•œ ê°’ */
  color: #ffffff; /* ê¸€ììƒ‰ ë³€ê²½ */
  width: 320px;
  padding: 10px;
  border-radius: 8px;
  box-shadow: 0px 0px 10px 0px rgba(0, 0, 0, 0.5); /* ê·¸ë¦¼ì íš¨ê³¼ */
  overflow: hidden; /* ë„˜ì¹˜ëŠ” ë‚´ìš© ê°ì¶”ê¸° */
  z-index: 999; /* ë‹¤ë¥¸ ìš”ì†Œ ìœ„ì— í‘œì‹œ */
}

/* í…ìŠ¤íŠ¸ì—ë¦¬ì•„ ìŠ¤íƒ€ì¼ë§ */
textarea {
  width: 100%;
  min-height: 50px; /* ìµœì†Œ ë†’ì´ (ì¡°ì ˆ ê°€ëŠ¥) */
  max-height: 150px; /* ìµœëŒ€ ë†’ì´ (ì¡°ì ˆ ê°€ëŠ¥) */
  padding: 10px;
  border: 2px solid #2c3e50; /* ë‹¤í¬ í…Œë§ˆ í…Œë‘ë¦¬ ìƒ‰ìƒ */
  border-radius: 8px;
  margin-top: 5px; /* ìˆ˜ì •: 5pxë¡œ ë³€ê²½ */
  background-color: #34495e; /* ë‹¤í¬ í…Œë§ˆ ë°°ê²½ìƒ‰ */
  color: #ecf0f1; /* ë‹¤í¬ í…Œë§ˆ ê¸€ììƒ‰ */
  resize: none;
  outline: none;
  transition: border-color 0.3s; /* í…Œë‘ë¦¬ ìƒ‰ìƒ ë³€í™” ì• ë‹ˆë©”ì´ì…˜ */
  overflow-y: hidden; /* ì„¸ë¡œ ìŠ¤í¬ë¡¤ì„ ê°ì¶¤ */
  box-sizing: border-box; /* íŒ¨ë”©, í…Œë‘ë¦¬ë¥¼ ìš”ì†Œì˜ ë„ˆë¹„ì™€ ë†’ì´ì— í¬í•¨ */
  line-height: 1.5; /* ì¤„ ë†’ì´ (ì¡°ì ˆ ê°€ëŠ¥) */
  font-size: 14px; /* ê¸€ì í¬ê¸° (ì¡°ì ˆ ê°€ëŠ¥) */
}

/* í¬ì»¤ìŠ¤ ì‹œ í…Œë‘ë¦¬ ìƒ‰ìƒ ë³€í™” */
textarea:focus {
  border-color: #3498db; /* í¬ì»¤ìŠ¤ ì‹œ í…Œë‘ë¦¬ ìƒ‰ìƒ ë³€ê²½ */
}

/* Form ë‚´ì˜ input ìŠ¤íƒ€ì¼ë§ */
.input-group-sm > .form-control {
  width: 100%;
  padding: 10px;
  margin-bottom: 10px;
  border: 2px solid #34495e; /* ë‹¤í¬ í…Œë§ˆ í…Œë‘ë¦¬ ìƒ‰ìƒ */
  border-radius: 8px;
  background-color: #fff; /* ë‹¤í¬ í…Œë§ˆ ë°°ê²½ìƒ‰ */
  color: #24262a; /* ë‹¤í¬ í…Œë§ˆ ê¸€ììƒ‰ */
  transition: border-color 0.3s; /* í…Œë‘ë¦¬ ìƒ‰ìƒ ë³€í™” ì• ë‹ˆë©”ì´ì…˜ */
}

/* Input í¬ì»¤ìŠ¤ ì‹œ í…Œë‘ë¦¬ ë° ë°•ìŠ¤ ì‰ë„ìš° ìŠ¤íƒ€ì¼ë§ */
.input-group-sm > .form-control:focus {
  outline: none;
  border-color: #dfe2ea; /* í¬ì»¤ìŠ¤ ì‹œ í…Œë‘ë¦¬ ìƒ‰ìƒ (ë” ë°ì€ íŒŒë€ìƒ‰) */
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); /* í¬ì»¤ìŠ¤ ì‹œ ë°•ìŠ¤ ì‰ë„ìš° (ì¡°ì ˆ ê°€ëŠ¥) */
}






/* ì…ë ¥ì°½ ë‚´ë¶€ ì• ë‹ˆë©”ì´ì…˜ */
.input-group:focus-within textarea {
  transition: height 0.3s, border-color 0.3s; /* ë†’ì´ ë° í…Œë‘ë¦¬ ìƒ‰ìƒ ë³€í™” ì• ë‹ˆë©”ì´ì…˜ */
  border-color: #3498db; /* í¬ì»¤ìŠ¤ ì‹œ í…Œë‘ë¦¬ ìƒ‰ìƒ ë³€ê²½ */
}

/* í”Œë ˆì´ìŠ¤í™€ë” ìŠ¤íƒ€ì¼ë§ */
textarea::placeholder {
  color: #95a5a6; /* í”Œë ˆì´ìŠ¤í™€ë” ìƒ‰ìƒ (ì¡°ì ˆ ê°€ëŠ¥) */
}
/* í…ìŠ¤íŠ¸ì—ë¦¬ì•„ ë‚´ìš©ì— ë”°ë¼ ëŠ˜ì–´ë‚˜ê²Œ í•˜ê¸° */
textarea:focus {
  height: auto;
}



/* ì…ë ¥ì°½ ë‚´ë¶€ ì• ë‹ˆë©”ì´ì…˜ */
.input-group:focus-within textarea {
  transition: height 0.3s, border-color 0.3s; /* ë†’ì´ ë° í…Œë‘ë¦¬ ìƒ‰ìƒ ë³€í™” ì• ë‹ˆë©”ì´ì…˜ */
  border-color: #3498db; /* í¬ì»¤ìŠ¤ ì‹œ í…Œë‘ë¦¬ ìƒ‰ìƒ ë³€ê²½ */
}
/* ì´ëª¨ì§€ ìŠ¤íƒ€ì¼ë§ */
.emoji {
  font-size: 20px; /* ì´ëª¨ì§€ í¬ê¸° */
  margin-right: 5px; /* ì´ëª¨ì§€ ê°„ê²© ì¡°ì ˆ */
}
/* ì´ëª¨ì§€ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ */
.emoji {
  opacity: 0;
  animation: fadeIn 0.5s ease-in-out forwards;
}

@keyframes fadeIn {
  to {
    opacity: 1;
  }
}

/* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ */
.scrollbarContainer {

  overflow-y: scroll; /* ìŠ¤í¬ë¡¤ í•­ìƒ í‘œì‹œ */
  padding: 10px;
  border-radius: 8px;
  flex-grow: 1;
  scroll-behavior: smooth; /* ìë™ìœ¼ë¡œ ìŠ¤í¬ë¡¤ ì´ë™ ì• ë‹ˆë©”ì´ì…˜ ì ìš© */
  max-height: 500px; /* ì ì ˆí•œ ë†’ì´ë¡œ ì„¤ì • (ì¡°ì ˆ ê°€ëŠ¥) */
}

/* ì±„íŒ…ì°½ ë‚´ë¶€ ìŠ¤íƒ€ì¼ë§ */
.msgArea {
  scroll-snap-type: y mandatory;
  animation: scrollDown 0.5s ease-out; /* ìŠ¤í¬ë¡¤ì´ ìµœí•˜ë‹¨ìœ¼ë¡œ ì´ë™í•˜ëŠ” ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€ */
}

/* ìŠ¤í¬ë¡¤ ì´ë™ ì• ë‹ˆë©”ì´ì…˜ keyframes */
@keyframes scrollDown {
  to {
    transform: translateY(calc(-100%)); /* 100%ë§Œí¼ ì´ë™ */
  }
}

/* ì…ë ¥ì°½ ë° ì „ì†¡ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
.input-group {
  margin-top: 10px;
}

.sendBtn {
  display: none;
}

/* ì¶”ê°€ëœ ë¶€ë¶„ í°íŠ¸ í¬ê¸° ì¡°ì ˆ ìŠ¤íƒ€ì¼ */
.dropdown-menu li {
  padding: 5px;
}
  </style>
</head>
<body>
<div th:replace="~{/layout/fragments :: myheader}"></div>
<div th:replace="~{/layout/fragments :: mysidebar}"></div>
<div class="void" >
    <input class="dummy"d-none th:value="${channel.channelId}" font-data="medium" auth-data="">
</div>
<section class="home">
      <!-- ìŠ¤íŠ¸ë¦¬ë° í”Œë ˆì´ì–´ ì¶”ê°€ -->
<div class="video-container">
    <video id="video" controls autoplay></video>
    <div style="margin-left: 10px; color: white;">
        <div class="align-items-center d-flex my-3">
            <div class="position-relative">
                <img id="channelImage" class="channelImageStyle my-3 img-fluid rounded-circle me-3 position-relative z-index-1" alt="channelImg" th:src="${channel.channelProfileImg}" style="width: 75px; height: 75px;">
                <span id="liveBadge" class="position-absolute bottom-0 start-50 translate-middle badge bg-danger d-none" style="transform: translate(-50%, 50%);">LIVE</span>
            </div>
            <div>
                <span class="fw-bold d-block mb-1 fs-5" th:text="${channel.channelUserAccountEntity.userNickname}"></span>
                <span class="d-block mb-1" th:text="${channel.channelTitle}"></span>
                <span class="d-block mb-1" th:text="${channel.categoryEntityOfChannel.categoryName}"></span>
                <small class="d-block" th:text="|${channel.channelViewerCount} ëª… ì‹œì²­ì¤‘|"></small>
            </div>
            <div style="position: absolute; left: 1300px;">
                <input class="d-none" id="authentication" th:value="${#authentication != null ? #authentication.name : null}" />
                <input class="d-none" id="channelUserId" th:value="${streamer.userId}" />
                <input class="d-none" id="channelUserNickname" th:value="${streamer.userNickname}" />
                <input class="d-none" id="loginUserId" th:value="${userAccount.userId}"/>
                <input class="d-none" id="channelStateSet" th:value="${channel.streamingStateSet}"/>
                <button id="followBtn" type="button" class="btn btn-outline-primary mb-2" onclick="follow()"><i class="fas fa-heart"></i></button>
                <button id="unfollowBtn" type="button" class="btn btn-outline-danger d-none" onclick="unfollow()"><i class="fas fa-heart-broken"></i></button>
            </div>
        </div>
    </div>
</div>
<script>
const channelStateSet = document.getElementById('channelStateSet');
const channelImage = document.getElementById('channelImage');
const liveBadge = document.getElementById('liveBadge');

if (channelStateSet.value.includes('ON')) {
    liveBadge.classList.remove('d-none');
    if (channelImage) {
        channelImage.style.border = '5px solid #05BB83';
    }
}
</script>
      <script th:inline="javascript">
        /*<![CDATA[*/
        const videoSrc = [[${streamingUrl}]];
        const video = document.getElementById('video');

        if (Hls.isSupported()) {
          const hls = new Hls();
          hls.loadSource(videoSrc);
          hls.attachMedia(video);
        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
          video.src = videoSrc;
        }
        /*]]>*/
      </script>
     
   
      
    <div class="cnter-item">
      <div class="chat-container">
        <div class="scrollbarContainer">
          <div class="msgArea"></div>
        </div>
        <div class="input-group input-group-sm">
          <textarea  type="text" placeholder="ë³´ë‚¼ ë©”ì„¸ì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”." class="form-control content" rows="2" style="margin-bottom: 5px;" maxlength="1000"></textarea>
        </div>
        <div class="flexAndBetween">
          <input class="chatState" style="display: none;" th:value="${chatState}">
          <div class="dropup">
           <button type="button" class="btn btn-sm" data-bs-toggle="dropdown" aria-expanded="false" data-bs-auto-close="outside">
              <svg width="20" height="20" viewBox="0 0 20 20" focusable="false" aria-hidden="true" role="presentation" style="margin-right: 0%;">
                <path fill="#ffffff" d="M10 8a2 2 0 1 0 0 4 2 2 0 0 0 0-4z"></path>
                <path fill="#ffffff" fill-rule="evenodd" d="M9 2h2a2.01 2.01 0 0 0 1.235 1.855l.53.22a2.01 2.01 0 0 0 2.185-.439l1.414 1.414a2.01 2.01 0 0 0-.439 2.185l.22.53A2.01 2.01 0 0 0 18 9v2a2.01 2.01 0 0 0-1.855 1.235l-.22.53a2.01 2.01 0 0 0 .44 2.185l-1.415 1.414a2.01 2.01 0 0 0-2.184-.439l-.531.22A2.01 2.01 0 0 0 11 18H9a2.01 2.01 0 0 0-1.235-1.854l-.53-.22a2.009 2.009 0 0 0-2.185.438L3.636 14.95a2.009 2.009 0 0 0 .438-2.184l-.22-.531A2.01 2.01 0 0 0 2 11V9c.809 0 1.545-.487 1.854-1.235l.22-.53a2.009 2.009 0 0 0-.438-2.185L5.05 3.636a2.01 2.01 0 0 0 2.185.438l.53-.22A2.01 2.01 0 0 0 9 2zm-4 8 1.464 3.536L10 15l3.535-1.464L15 10l-1.465-3.536L10 5 6.464 6.464 5 10z" clip-rule="evenodd"></path>
              </svg>
            </button>
            <ul class="dropdown-menu" style="width: 15vw">
              <li class="tmtm">
                <div class="wrapper flexAndBetween">
                  <span style="font-size: small; padding-top: 4px;">íŒ”ë¡œì›Œ ì±— í™œì„±í™”</span>
                  <input type="checkbox" id="switch1">
                  <label for="switch1" class="switch_label">
                    <span class="onf_btn"></span>
                  </label>
                </div>
              </li>
              <li class="tmtm">
                <div class="wrapper flexAndBetween">
                  <span style="font-size: small; padding-top: 4px;">ìµëª…ì±„íŒ…</span>
                  <input type="checkbox" id="switch2">
                  <label for="switch2" class="switch_label">
                    <span class="onf_btn"></span>
                  </label>
                </div>
              </li>
              <li>
                <div class="wrapper flexAndBetween">
                  <span style="font-size: small; padding-top: 4px;">ìŠ¤íŠ¸ë¦¬ë¨¸ë§Œ ì±„íŒ… (ì–¼ë¦¬ê¸°)</span>
                  <input type="checkbox" id="switch3">
                  <label for="switch3" class="switch_label">
                    <span class="onf_btn"></span>
                  </label>
                </div>
              </li>
              <!-- ì¶”ê°€ëœ ë¶€ë¶„ -->
              <li>
                <div class="wrapper flexAndBetween">
                  <span style="font-size: small; padding-top: 2px;">í°íŠ¸ í¬ê¸° ì¡°ì ˆ</span>
                  <div class="dropup">
                    <button type="button" class="btn btn-sm" data-bs-toggle="dropdown" aria-expanded="false" data-bs-auto-close="outside">
                      <svg width="20" height="20" viewBox="0 0 20 20" focusable="false" aria-hidden="true" role="presentation" style="margin-right: 0%;">
                        <path d="M10 8a2 2 0 1 0 0 4 2 2 0 0 0 0-4z"></path>
                        <path fill-rule="evenodd" d="M9 2h2a2.01 2.01 0 0 0 1.235 1.855l.53.22a2.01 
                                            2.01 0 0 0 2.185-.439l1.414 1.414a2.01 2.01 0 0 0-.439 2.185l.22.53A2.01 2.01 
                                            0 0 0 18 9v2a2.01 2.01 0 0 0-1.855 1.235l-.22.53a2.01 2.01 0 0 0 .44 2.185l-1.415 
                                            1.414a2.01 2.01 0 0 0-2.184-.439l-.531.22A2.01 2.01 0 0 0 11 18H9a2.01 2.01 0 0 
                                            0-1.235-1.854l-.53-.22a2.009 2.009 0 0 0-2.185.438L3.636 14.95a2.009 2.009 0 0 
                                            0 .438-2.184l-.22-.531A2.01 2.01 0 0 0 2 11V9c.809 0 1.545-.487 1.854-1.235l.22-.53a2.009 
                                            2.009 0 0 0-.438-2.185L5.05 3.636a2.01 2.01 0 0 0 2.185.438l.53-.22A2.01 2.01 0 0 0 9 
                                            2zm-4 8 1.464 3.536L10 15l3.535-1.464L15 10l-1.465-3.536L10 5 6.464 6.464 5 10z" clip-rule="evenodd"></path>
                      </svg>
                    </button>
                    <ul class="dropdown-menu">
                      <li class="dropdown-item" style="font-size: xx-large;" id="XXL">
                        <span>ë…¸ì¸ë„¤ ì‚¬ì´ì¦ˆ</span>
                      </li>
                      <li class="dropdown-item" style="font-size: x-large;" id="XL">
                        <span>ì•„ì£¼ í¬ê²Œ</span>
                      </li>
                      <li class="dropdown-item" style="font-size: large;" id="L">
                        <span>í¬ê²Œ</span>
                      </li>
                      <li class="dropdown-item" style="font-size: medium;" id="M">
                        <span>ì¤‘ê°„</span>
                      </li>
                      <li class="dropdown-item" style="font-size: small;" id="S">
                        <span>ì‘ê²Œ</span>
                      </li>
                      <li class="dropdown-item" style="font-size: x-small;" id="XS">
                        <span>ì•„ì£¼ ì‘ê²Œ</span>
                      </li>
                    </ul>
                  </div>
                </div>
              </li>
              <!-- ì¶”ê°€ëœ ë¶€ë¶„ ë -->
              <li>
                <div class="wrapper flexAndBetween">
                  <span style="font-size: small; padding-top: 2px;">ìŠ¤íŠ¸ë¦¬ë¨¸ë§Œ ì±„íŒ… (ì–¼ë¦¬ê¸°)</span>
                  <input type="checkbox" id="switch5">
                  <label for="switch5" class="switch_label">
                    <span class="onf_btn"></span>
                  </label>
                </div>
              </li>
            </ul>
          </div>
          <button type="button" class="sendBtn btn btn-sm text-white flex-right" style="background-color: blueviolet; margin-left: auto;" onclick="sendMsg()">ì „ì†¡</button>
        </div>
      </div>
    </div>
    
</section>
<div>
    <footer th:replace="layout/fragments :: myfooter"></footer>
</div>
<script th:replace="~{layout/fragments :: sidebar_js}"></script>
<script th:replace="~{layout/fragments :: bootstrap_js}"></script>
<script src="/js/fragments-categories-search.js"></script>
<script src="/js/sse.js"></script>
<script src="/js/switch.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="/js/follow.js"></script>
<script src="/js/broadcast.js"></script>
<script th:inline="javascript">
   
    window.addEventListener("DOMContentLoaded", loadUserAuth());

    function loadUserAuth() {
        
        let userNickname = [[${userAccount.userNickname}]]; 
        let channelId = [[${channel.channelId}]];
        
        axios.get('/api/user/auth', { params: { channelId: channelId } })
                    .then((response) => {
                        let data = response.data;
                        
                        const element = document.querySelector('.dummy');
                        
                        element.setAttribute('auth-data', data);
                        
                    })
                    .catch((error) => {
                        console.log(error);
                    });
    }
    
    const channelId = document.querySelector('.dummy').value;
    
    // í˜„ì¬ í°íŠ¸ ì„¤ì •
    let element = document.querySelector('.dummy');
    

    // í°íŠ¸ ì„ íƒ
    const fontXxl = document.querySelector('#XXL');
    const fontXl = document.querySelector('#XL');
    const fontL = document.querySelector('#L');
    const fontM = document.querySelector('#M');
    const fontXs = document.querySelector('#XS');
    const fontS = document.querySelector('#S');
    
    fontXxl.addEventListener('click', function() {
        let chat = document.querySelectorAll('.chat');
        chat.forEach(x => x.style.fontSize = 'xx-large'); 
        element.setAttribute('font-data', 'xx-large');  
    });
    fontXl.addEventListener('click', function() {
        let chat = document.querySelectorAll('.chat');
        chat.forEach(x => x.style.fontSize = 'x-large');
        element.setAttribute('font-data', 'x-large');   
    });
    fontL.addEventListener('click', function() {
        let chat = document.querySelectorAll('.chat');
        chat.forEach(x => x.style.fontSize = 'large');
        element.setAttribute('font-data', 'large');   
    });
    fontM.addEventListener('click', function() {
        let chat = document.querySelectorAll('.chat');
        chat.forEach(x => x.style.fontSize = 'medium'); 
        element.setAttribute('font-data', 'medium');  
    });
    fontS.addEventListener('click', function() {
        let chat = document.querySelectorAll('.chat');
        chat.forEach(x => x.style.fontSize = 'small');
        element.setAttribute('font-data', 'small'); 
    });
    fontXs.addEventListener('click', function() {
        let chat = document.querySelectorAll('.chat');
        chat.forEach(x => x.style.fontSize = 'x-small');
        element.setAttribute('font-data', 'x-small');   
    });
    
    function enterRoom(socket) {
        var enterMsg = {
            "type": "ENTER",
            "userType": [[${userState}]],
            "veiwers": 0,
            "roomId": [[${room.roomId}]],
            "sender": [[${userAccount.userNickname}]],
            "message": ""
        };
        console.log(enterMsg);
        socket.send(JSON.stringify(enterMsg));

        let user = [[${userAccount.userNickname}]];
        let entMsg = user + "ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤!";
        let msgArea = document.querySelector('.msgArea');
        let newMsg = document.createElement('div');

        if (user !== 'anonymousUser') {
            newMsg.innerText = entMsg;
            newMsg.style.color = '#3498db'; // ì ì ˆí•œ ìƒ‰ìƒìœ¼ë¡œ ë³€ê²½
            msgArea.append(newMsg);
        } else if (user === 'anonymousUser') {
            newMsg.innerText = [[${streamer.userNickname}]] + "ë‹˜ì˜ ë°©ì†¡ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!";
            newMsg.style.color = '#e74c3c'; // ì ì ˆí•œ ìƒ‰ìƒìœ¼ë¡œ ë³€ê²½
            msgArea.append(newMsg);
        }
    }
    
    let socket = new WebSocket("ws://192.168.20.26:8081/ws/chat");

    socket.onopen = function (e) {
        console.log('open server!')
        enterRoom(socket);
    }
    
    socket.onclose = function(e){
        console.log('disconnet');
    }

    socket.onerror = function (e){
        console.log(e);
    }

    function updateScroll() {
        var scroll = document.querySelector('.scrollbarContainer');
        scroll.scrollTop = scroll.scrollHeight;
    }
    
    let chatNo = 0;
    
    //ë©”ì„¸ì§€ ìˆ˜ì‹ í–ˆì„ ë•Œ ì´ë²¤íŠ¸.
    socket.onmessage = function (e) {
        chatNo += 1;
        
        console.log(e.data);
        console.log(chatNo);
        let msgArea = document.querySelector('.msgArea');
        let newMsg = document.createElement('div');

        let fontData = element.getAttribute('font-data');
        newMsg.className = 'chat';
        newMsg.style = 'display: flex;';
        
        if(fontData === 'xx-large') {
            newMsg.style.fontSize = 'xx-large'
        } else if(fontData === 'x-large') {
            newMsg.style.fontSize = 'x-large'
        } else if(fontData === 'large') {
            newMsg.style.fontSize = 'large'
        } else if(fontData === 'medium') {
            newMsg.style.fontSize = 'medium'
        } else if(fontData === 'small') {
            newMsg.style.fontSize = 'small'
        } else if(fontData === 'x-small') {
            newMsg.style.fontSize = 'x-small'
        }
        //JSON.parse()ëŠ” JSON ë¬¸ìì—´ì„ javascript ë¦¬í„°ëŸ´ ê°ì²´ í˜¹ì€ ë°°ì—´ë¡œ ë³€í™˜í•¨
        let message = JSON.parse(e.data);
        
        if(message.sender === [[${streamer.userNickname}]] && message.message === [[${userAccount.userNickname}]] + 'ë‹˜ì´ ë§¤ë‹ˆì €ë¡œ ì„ëª…ë˜ì—ˆìŠµë‹ˆë‹¤.') {
            loadUserAuth();
        } else if (message.sender === [[${streamer.userNickname}]] && message.message === [[${userAccount.userNickname}]] + 'ë‹˜ì´ ë§¤ë‹ˆì €ì—ì„œ í•´ì„ë˜ì—ˆìŠµë‹ˆë‹¤.') {
            loadUserAuth();
        }
        
        let elemental = document.querySelector('.dummy');
        let userAuth = elemental.getAttribute('auth-data');
        
        let sender = `
        <div class="dropdown">
            <span data-bs-toggle="dropdown" aria-expanded="false" class="chat btn btn-link" 
            style="color: black; text-decoration: none; padding: 0px; border: 0px; margin-bottom: 3px;">
                ${message.sender}
            </span>
            <ul class="dropdown-menu">
                <li>
                    <span class="dropdown-item chat ban" data-id="${message.sender}" id=${chatNo}>
                        ë„ˆ ë°´
                    </span>
                </li>`;
        if([[${userAccount.userNickname}]] === [[${streamer.userNickname}]] && message.userType === 'MANAGER') {
            sender += 
                `<li>
                    <span class="dropdown-item chat managerRevoke" data-id="${message.sender}" id=${chatNo}>
                        ë§¤ë‹ˆì € ê¶Œí•œ ì·¨ì†Œ
                    </span>
                </li>`;
        }
        if([[${userAccount.userNickname}]] === [[${streamer.userNickname}]] && message.userType !== 'MANAGER') {
            sender += 
                `<li>
                    <span class="dropdown-item chat manager" data-id="${message.sender}" id=${chatNo}>
                        ë„ˆ ë§¤ë‹ˆì €
                    </span>
                </li>`;
        }
        sender += 
        `   </ul>             
        </div>`;
        
     // ëœë¤ ìƒ‰ìƒ ë§¤í•‘ ê°ì²´
        let colorMapping = {};

        // ëœë¤ ìƒ‰ìƒ ìƒì„± í•¨ìˆ˜
        function getRandomColor() {
            const letters = '0123456789ABCDEF';
            let color = '#';
            for (let i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }

        // senderê°€ í•´ë‹¹ ì±„ë„ì˜ ìŠ¤íŠ¸ë¦¬ë¨¸ì¼ ê²½ìš° ê°•ì¡°í•´ì„œ í‘œì‹œ
        if (message.sender === [[${streamer.userNickname}]]) {
            newMsg.innerHTML = 'ğŸ‘‘' + '<strong>' + message.sender + ':' + message.message + '</strong>';
        } else {
            let senderDisplayName = message.sender;

            // ì €ì¥ëœ ë‹‰ë„¤ì„ì— ëŒ€í•œ ëœë¤ ìƒ‰ìƒ í™•ì¸
            let senderColor = colorMapping[senderDisplayName];

            // ìƒ‰ìƒì´ ì—†ë‹¤ë©´ ìƒˆë¡œìš´ ëœë¤ ìƒ‰ìƒ ìƒì„±
            if (!senderColor) {
                senderColor = getRandomColor();
                colorMapping[senderDisplayName] = senderColor;
            }

            // ì±„íŒ… íƒ€ì…ì— ë”°ë¼ ë‹‰ë„¤ì„ê³¼ ë©”ì‹œì§€ ì¶œë ¥
            if (message.userType === "MANAGER") {
                senderDisplayName = 'âš”' + senderDisplayName;
            } else if (message.userType === "FOLLOW") { // íŒ”ë¡œì›Œì¼ ê²½ìš° ì±„íŒ… ë³€ê²½
                senderDisplayName = 'ğŸ‘ï¸' + senderDisplayName;
            }

            newMsg.innerHTML = `<span style="color: ${senderColor};">${senderDisplayName}:</span> ${message.message}`;
        }

        if (message.type === 'TALK') {
            msgArea.append(newMsg);
        }

        updateScroll();
        
        let banUser = document.querySelector(`span.ban[id="${chatNo}"]`);
        if (banUser !== null) {            
            banUser.addEventListener('click', function ban() {
                let auth = elemental.getAttribute('auth-data');
                
                if(auth === 'MANAGER' || [[${streamer.userNickname}]] === [[${userAccount.userNickname}]]) {
                    
                    let userNickname = banUser.getAttribute('data-id');
                    
                    const data = { userNickname, channelId };
                    
                    axios.post('/api/user/ban', data)
                    .then((response) => {
                        console.log(response);
                        let userNickname = banUser.getAttribute('data-id');
                        document.querySelector('.content').value = userNickname + 'ë‹˜ì´ ë°´ ë˜ì—ˆìŠµë‹ˆë‹¤.';
                        sendMsg();
                    })
                    .catch((error) => {
                        console.log(error);
                    });
                    
                }
                
                
            });
        }
        
        let manager = document.querySelector(`span.manager[id="${chatNo}"]`)
        if (manager !== null) {            
            manager.addEventListener('click', function() {
                let userNickname = manager.getAttribute('data-id');
                
                const data = { userNickname, channelId };
               
                axios.post('/api/user/manager', data)
                .then((response) => {
                    console.log(response);
                    let userNickname = manager.getAttribute('data-id');
                    document.querySelector('.content').value = userNickname + 'ë‹˜ì´ ë§¤ë‹ˆì €ë¡œ ì„ëª…ë˜ì—ˆìŠµë‹ˆë‹¤.';
                    sendMsg();
                })
                .catch((error) => {
                    console.log(error);
                });
                
            });
        }
        
        let managerRevoke = document.querySelector(`span.managerRevoke[id="${chatNo}"]`)
        if (managerRevoke !== null) {            
            managerRevoke.addEventListener('click', function() {
                let userNickname = managerRevoke.getAttribute('data-id');
                
                const data = { userNickname, channelId };
               
                axios.post('/api/user/managerRevoke', data)
                .then((response) => {
                    console.log(response);
                    let userNickname = managerRevoke.getAttribute('data-id');
                    document.querySelector('.content').value = userNickname + 'ë‹˜ì´ ë§¤ë‹ˆì €ì—ì„œ í•´ì„ë˜ì—ˆìŠµë‹ˆë‹¤.';
                    sendMsg();
                })
                .catch((error) => {
                    console.log(error);
                });
                
            });
        }
        
    }
    

    document.addEventListener('keydown', function(event) {
        if (event.keyCode === 13) {
            event.preventDefault(); // ê¸°ë³¸ Enter í–‰ë™ ë§‰ê¸° (í¼ ì „ì†¡ ë“±)
            sendMsg();
        }
    });
    
    //ë©”ì„¸ì§€ ë³´ë‚´ê¸° ë²„íŠ¼ ëˆŒë €ì„ ë–„..
    function sendMsg() {
        let content=document.querySelector('.content').value;
        if(content === '') {
            return;
        }
        
        const uri = '/api/chat/chatState/' + channelId;
        
        axios.get(uri)
        .then((response) => {
            let data = response.data;
            let userId = [[${userAccount.userNickname}]];
            let userType = data.userType;
         
            if (userType === 'BAN') {
                document.querySelector('.content').value = 'í•´ë‹¹ ë°©ì†¡ì—ì„œ ì±„íŒ… ê¶Œí•œì„ ë°•ë‹¬ë‹¹í•˜ì…¨ìŠµë‹ˆë‹¤. ã… ã… ';
                return;
            } else if([[${userAccount.userNickname}]] === 'anonymousUser' && data.chatState !== '[ANONYMOUS]'){
                document.querySelector('.content').value = 'ì±„íŒ…ì€ ë¡œê·¸ì¸ ì´í›„ ì´ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.';
                return;
            } else if(userType === 'NON_FOLLOW' && data.chatState === '[FOLLOW]') {
                document.querySelector('.content').value = 'í˜„ì¬ ì±„íŒ…ë°©ì— íŒ”ë¡œìš°ì±—ì´ ì ìš©ë˜ê³  ìˆìŠµë‹ˆë‹¤.';
                return;
            } else if(userType !== 'STREAMER' && data.chatState === '[STREAMER_ONLY]') {
                document.querySelector('.content').value = 'í˜„ì¬ ì±„íŒ…ë°©ì— ìŠ¤íŠ¸ë¦¬ë¨¸ì±—ì´ ì ìš©ë˜ê³  ìˆìŠµë‹ˆë‹¤.';
                return;
            }
        
            var talkMsg = {
                    "type" : "TALK",
                    "userType" : userType,
                    "roomId":[[${room.roomId}]],
                    "sender": userId,
                    "message":content};
            //JSON.stringify(quitMsg) -> json í˜•ì‹ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì „ì†¡í•˜ê¸° ìœ„í•´ì„œ ë¬¸ìì—´ë¡œ ë³€í™˜í•˜ëŠ” ë©”ì„œë“œ.
            socket.send(JSON.stringify(talkMsg));
        
            document.querySelector('.content').value = '';
        })
        .catch((error) => {
            console.log(error);
        });
    }

    window.addEventListener('beforeunload', handlePageUnload);

    function quit(){
        var quitMsg={"type" : "QUIT", 
                    "userType" : [[${userState}]], 
                    "roomId":[[${room.roomId}]] ,
                    "sender":[[${userAccount.userNickname}]],
                    "message":""};
        //JSON.stringify(quitMsg) -> json í˜•ì‹ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì „ì†¡í•˜ê¸° ìœ„í•´ì„œ ë¬¸ìì—´ë¡œ ë³€í™˜í•˜ëŠ” ë©”ì„œë“œ.
        socket.send(JSON.stringify(quitMsg));
        socket.close();
        location.href="/";
    }

    function handlePageUnload() {
        quit();
    }
    // ì¶”ê°€ëœ ë¶€ë¶„: ëœë¤ìœ¼ë¡œ ìƒ‰ìƒì„ ìƒì„±í•˜ëŠ” í•¨ìˆ˜
    function getRandomColor() {
      const letters = '0123456789ABCDEF';
      let color = '#';
      for (let i = 0; i < 6; i++) {
        color += letters[Math.floor(Math.random() * 16)];
      }
      return color;
    }


</script>
<script th:inline="javascript">
  const authentication = /*[[${#authentication.name}]]*/ null;
</script>


</body>
</html>